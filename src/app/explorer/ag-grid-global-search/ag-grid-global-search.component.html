<div class="global-search-container">
  <div class="toolbar">
    <mat-form-field>
      <mat-label>Search</mat-label>
      <input
        matInput
        #searchBox
        (input)="onSearchChange(searchBox.value)"
        placeholder="Keyword..."
      />
    </mat-form-field>
  </div>

  <mat-accordion>
    <mat-expansion-panel
      *ngFor="let collection of allCollectionsData"
      [expanded]="false"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{ collection.entityName }} ({{ collection.total }} results)
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="global-search-grid">
        <ag-grid-angular
          style="width: 100%; height: 600px"
          class="ag-theme-alpine"
          [columnDefs]="collection.columnDefs"
          [defaultColDef]="defaultColDef"
          [rowData]="collection.data"
          [pagination]="false"
          (gridReady)="onGridReady($event, collection.entityName)"
          (sortChanged)="onSortChanged($event, collection)"
        ></ag-grid-angular>

        <div class="pagination-controls" *ngIf="collection.total > 0">
          <button
            mat-button
            (click)="onPageChange(collection, collection.page - 1)"
            [disabled]="collection.page <= 1"
          >
            Prev
          </button>
          <span>
            Showing {{ (collection.page - 1) * collection.limit + 1 }}â€“
            {{ Math.min(collection.page * collection.limit, collection.total) }}
            of {{ collection.total }}
          </span>
          <span>
            Page {{ collection.page }} of
            {{ Math.ceil(collection.total / collection.limit) }}
          </span>
          <button
            mat-button
            (click)="onPageChange(collection, collection.page + 1)"
            [disabled]="
              collection.page >= Math.ceil(collection.total / collection.limit)
            "
          >
            Next
          </button>

          <mat-form-field>
            <mat-label>Rows per page</mat-label>
            <mat-select
              [value]="collection.limit"
              (selectionChange)="onLimitChange(collection, $event.value)"
            >
              <mat-option [value]="10">10</mat-option>
              <mat-option [value]="25">25</mat-option>
              <mat-option [value]="50">50</mat-option>
              <mat-option [value]="100">100</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
